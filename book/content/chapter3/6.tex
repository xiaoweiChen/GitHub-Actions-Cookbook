åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º github-script çš„æ“ä½œæ¥åœ¨å¤åˆæ“ä½œä¸­åˆ©ç”¨å·¥å…·åŒ…çš„å¼ºå¤§åŠŸèƒ½ã€‚

\mySubsubsection{3.6.1}{How to do itâ€¦}

\begin{enumerate}
\item 
ä» action.yml æ–‡ä»¶ä¸­ç§»é™¤åŒ…å« Bash è„šæœ¬çš„ run æ­¥éª¤ï¼Œå¹¶ç”¨ github-script æ“ä½œæ›¿æ¢å®ƒï¼š

\begin{shell}
- name: Awesome github script action
  uses: actions/github-script@v6
  with:
    script: |
\end{shell}

\item 
ä½¿ç”¨å·¥å…·åŒ…è¯»å–è¾“å…¥å‚æ•°ï¼Œå°†é—®å€™æ¶ˆæ¯å†™å…¥æ—¥å¿—ï¼Œå¹¶è®¾ç½®è¾“å‡ºå‚æ•°ã€‚è¿™äº›å†…å®¹åœ¨ åˆ›å»º TypeScript æ“ä½œ çš„ç¤ºä¾‹ä¸­åº”è¯¥å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼š

\begin{shell}
var whoToGreet = core.getInput('who-to-greet')
core.notice(`Hello ${whoToGreet}`)
core.setOutput('answer', 42)
\end{shell}

\item 
ä¸ºäº†æ·»åŠ è¿™ä¸ªé¢å¤–çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥è§¦å‘å·¥ä½œæµçš„äº‹ä»¶æ˜¯å¦æ˜¯ issues äº‹ä»¶ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ github.rest.issues.createComment æ–¹æ³•å‘è¯¥é—®é¢˜æ·»åŠ ä¸€æ¡è¯„è®ºã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„å®ç°æ­¥éª¤ï¼š

\begin{tcolorbox}[ breakable,colback = bashcodebg, colframe= black!50!white]
\scriptsize{
if (context.eventName === 'issues') \{ \\
\hspace*{1em}github.rest.issues.createComment(\{ \\
\hspace*{2em}issue\_number: context.issue.number, \\
\hspace*{2em}owner: context.repo.owner, \\
\hspace*{2em}repo: context.repo.repo, \\
\hspace*{2em}body: '\emoji{ğŸ‘‹} Thanks for reporting!' \\
\hspace*{1em}\}) \\
\}
}
\end{tcolorbox}

\item 
åœ¨ CI å·¥ä½œæµä¸­ï¼Œæ·»åŠ ä¸€ä¸ªé¢å¤–çš„è§¦å‘å™¨ï¼Œä»¥ä¾¿åœ¨æ–°é—®é¢˜æ‰“å¼€æ—¶æ‰§è¡Œå·¥ä½œæµï¼š

\begin{shell}
on:
  issues:
    types: [opened]
\end{shell}

\item 
æäº¤å¹¶æ¨åŠ¨æ‚¨çš„ï¤æ”¹ã€‚

\item 
åœ¨æ‚¨çš„ä»“åº“ä¸­ï¼Œå‰å¾€ Issues | New issue(æˆ–è®¿é—® issues/new)ï¼Œä¸ºå…¶æ·»åŠ ä¸€ä¸ªæ ‡é¢˜å¹¶ä¿å­˜ã€‚å·¥ä½œæµå°†è¿è¡Œï¼Œå¹¶åœ¨è¯¥é—®é¢˜ä¸‹æ·»åŠ ä¸€æ¡è¯„è®ºï¼Œå¦‚å›¾ 3.11 æ‰€ç¤ºã€‚

\myGraphic{0.4}{content/chapter3/images/11.png}{å›¾3.11  ---  github-script æ“ä½œåœ¨æ–°é—®é¢˜ä¸Šæ·»åŠ è¯„è®º}

github-script æ“ä½œæ˜¯ä¸€ç§åˆ©ç”¨å·¥å…·åŒ…çš„å¼ºå¤§åŠŸèƒ½è¿›è¡ŒåŸå‹è®¾è®¡çš„ç»ä½³æ–¹æ³•ï¼Œä¸”æ— éœ€åˆ›å»ºå•ç‹¬çš„æ“ä½œã€‚
\end{enumerate}

\mySubsubsection{3.6.2}{How it worksâ€¦}

github-script æ“ä½œä½¿å¾—åœ¨å·¥ä½œæµæˆ–å¤åˆæ“ä½œä¸­å¿«é€Ÿç¼–å†™ä½¿ç”¨ GitHub API å’Œå·¥ä½œæµè¿è¡Œä¸Šä¸‹æ–‡çš„è„šæœ¬å˜å¾—éå¸¸å®¹æ˜“ã€‚ å®ƒä½¿ç”¨ä¸€ä¸ªåä¸º script çš„è¾“å…¥ï¼Œè¯¥è¾“å…¥åŒ…å«å¼‚æ­¥å‡½æ•°è°ƒç”¨çš„ä¸»ä½“ã€‚ä»¥ä¸‹å‚æ•°å°†ç”±è¯¥æ“ä½œæä¾›ï¼š

\begin{itemize}
\item 
github: ä¸€ä¸ªé¢„è®¤è¯çš„ octokit/rest.js å®¢æˆ·ç«¯ï¼ŒåŒ…å«åˆ†é¡µæ’ä»¶ã€‚

\item 
context: ä¸€ä¸ªåŒ…å«å·¥ä½œæµè¿è¡Œä¸Šä¸‹æ–‡çš„å¯¹è±¡ã€‚

\item 
core: å¯¹ @actions/core åŒ…çš„å¼•ç”¨ã€‚

\item 
glob: å¯¹ @actions/glob åŒ…çš„å¼•ç”¨ã€‚

\item 
io: å¯¹ @actions/io åŒ…çš„å¼•ç”¨ã€‚

\item 
exec: å¯¹ @actions/exec åŒ…çš„å¼•ç”¨ã€‚

\item 
fetch: å¯¹ node-fetch åŒ…çš„å¼•ç”¨ã€‚

\item 
require: ä¸€ä¸ªå›´ç»•æ™®é€š Node.js require çš„ä»£ç†åŒ…è£…å™¨ï¼Œç”¨äºæ”¯æŒç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„åŠ è½½ï¼Œä»¥åŠåœ¨å½“å‰å·¥ä½œç›®å½•ä¸­å®‰è£…çš„ npm åŒ…çš„åŠ è½½ã€‚
\end{itemize}

ç”±äºè„šæœ¬åªæ˜¯ä¸€ä¸ªå‡½æ•°ä½“ï¼Œè¿™äº›å€¼å·²ç»é¢„å…ˆå®šä¹‰å¥½äº†ï¼Œå› æ­¤æ‚¨æ— éœ€å¯¼å…¥å®ƒä»¬ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒæˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­ä½¿ç”¨ coreã€context å’Œ github é‚£æ ·ã€‚

è¦äº†è§£æ›´å¤šå…³äº github-script çš„ä¿¡æ¯ï¼Œè¯·è®¿é—® \url{https://github.com/actions/github-script}ã€‚

\mySubsubsection{3.6.3}{Thereâ€™s moreâ€¦}

åœ¨ YAML æ–‡ä»¶ä¸­çš„ç¼–è¾‘å’Œè°ƒè¯•ä½“éªŒå¯èƒ½ä¸æ˜¯å¾ˆå¥½ã€‚ç„¶è€Œï¼Œæ‚¨å¯ä»¥åœ¨æ“ä½œä¸­ä½¿ç”¨è„šæœ¬æ–‡ä»¶æ¥æ”¹å–„è¿™ä¸€è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

\begin{shell}
with:
  script: |
    const script = require('./path/to/script.js')
    await script({github, context, core})
\end{shell}

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥å°† github-script æ“ä½œçš„ç®€ä¾¿æ€§ä¸æ›´ä¼˜çš„ JavaScript ç¼–å†™ä½“éªŒç»“åˆèµ·æ¥ã€‚

github-script æ“ä½œæ˜¯ä¸€ç§å¿«é€Ÿå°è¯•æŸäº›åŠŸèƒ½å¹¶åˆ›å»ºæ¦‚å¿µéªŒè¯æˆ–ä¸€äº›é›†æˆçš„ç»ä½³æ–¹æ³•ã€‚é€šè¿‡å¤åˆæ“ä½œï¼Œæ‚¨å¯ä»¥é€æ¸å°†å…¶æ„å»ºæˆæ˜“äºå…±äº«çš„æ¨¡å—ã€‚å¤åˆæ“ä½œä¹Ÿæ˜¯ä¸€ç§æ‰“åŒ…å¯é‡ç”¨åŠŸèƒ½çš„ç®€å•æ–¹å¼ã€‚éšç€æ‚¨çš„è§£å†³æ–¹æ¡ˆä¸æ–­å‘å±•ï¼Œæ‚¨å¯èƒ½éœ€è¦è€ƒè™‘å°†å…¶è¿ç§»åˆ° TypeScript æˆ– Docker å®¹å™¨æ“ä½œä¸­ï¼Œä»¥è·å¾—æ›´å¥½çš„å¯ç»´æŠ¤æ€§ã€‚











