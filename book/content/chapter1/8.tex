
ç¯å¢ƒç”¨äºæè¿°ä¸€èˆ¬çš„éƒ¨ç½²ç›®æ ‡,ä¾‹å¦‚ï¼šå¼€å‘ã€æµ‹è¯•ã€æš‚å­˜æˆ–ç”Ÿäº§ã€‚å¯ä»¥ä½¿ç”¨ä¿æŠ¤è§„åˆ™æ¥ä¿æŠ¤ç¯å¢ƒ,å¹¶ä¸”å¯ä»¥ä¸ºç‰¹å®šç¯å¢ƒæä¾›é…ç½®å˜é‡å’Œå¯†é’¥ã€‚

\mySubsubsection{1.8.1}{Getting ready}

æˆ‘ä»¬å°†é¦–å…ˆä½¿ç”¨ Web UI åˆ›å»ºä¸€äº›ç¯å¢ƒï¼Œå¹¶æ·»åŠ ä¸€äº›ä¿æŠ¤è§„åˆ™ã€å¯†é’¥å’Œå˜é‡ã€‚ç„¶åï¼Œå°†å®ƒä»¬æ·»åŠ åˆ°ç°æœ‰çš„å·¥ä½œæµä¸­ã€‚

\mySubsubsection{1.8.2}{How to do itâ€¦}

\begin{enumerate}
\item 
å¯¼èˆªåˆ°\textbf{Settings | Environments}(è®¾ç½®|ç¯å¢ƒ)å¹¶ç‚¹å‡»\textbf{New environment}(æ–°ç¯å¢ƒ)(è§å›¾ 1.25)ï¼š

\myGraphic{0.6}{content/chapter1/images/25.png}{å›¾1.25 --- åº“ä¸­ç®¡ç†ç¯å¢ƒ}

è¾“å…¥åç§° Production å¹¶ç‚¹å‡»\textbf{Configure environment}(é…ç½®ç¯å¢ƒ)(è§å›¾ 1.26)ï¼š

\myGraphic{0.6}{content/chapter1/images/26.png}{å›¾1.26 --- åˆ›å»ºæ–°ç¯å¢ƒ}

\item 
å°†è‡ªå·±æ·»åŠ ä¸ºå¿…éœ€çš„å®¡æŸ¥è€…ï¼Œå¹¶ç‚¹å‡»\textbf{Save protection rule}(ä¿å­˜ä¿æŠ¤è§„åˆ™)(è§å›¾ 1.27)ï¼š

\myGraphic{0.6}{content/chapter1/images/27.png}{å›¾1.27 --- é…ç½®éƒ¨ç½²ä¿æŠ¤è§„åˆ™}

\item 
åœ¨\textbf{Deployment branches and tags}(éƒ¨ç½²åˆ†æ”¯å’Œæ ‡ç­¾)ä¸‹ï¼Œé€‰æ‹©\textbf{Selected branches and tags}(é€‰å®šçš„åˆ†æ”¯å’Œæ ‡ç­¾)ï¼Œç‚¹å‡»åŠ å·ï¼Œå¹¶ä¸º main åˆ†æ”¯æ·»åŠ ä¸€ä¸ªåç§°æ¨¡å¼(è§å›¾ 1.28)ï¼š

\myGraphic{0.7}{content/chapter1/images/28.png}{å›¾1.28 --- é…ç½®éƒ¨ç½²åˆ†æ”¯å’Œæ ‡ç­¾}

\item 
åœ¨\textbf{Environment secrets}(ç¯å¢ƒå¯†é’¥)ä¸‹ï¼Œç‚¹å‡»\textbf{Add secret}(æ·»åŠ å¯†é’¥)å¹¶æ·»åŠ ä¸€ä¸ªæ–°çš„ MY\_SECRET å¯†é’¥ï¼Œå…¶å€¼ä¸º Open Sesame(è§å›¾ 1.29)ã€‚é‡å¤æ­¤æ“ä½œï¼Œä½¿ç”¨\textbf{Add variable}(æ·»åŠ å˜é‡)æ·»åŠ ä¸€ä¸ª WHO\_TO\_GREET å˜é‡ï¼Œå…¶å€¼ä¸º Production usersï¼š

\myGraphic{0.7}{content/chapter1/images/29.png}{å›¾1.29 --- å‘ç¯å¢ƒæ·»åŠ å¯†é’¥å’Œå˜é‡}

\item 
é‡å¤æ­¥éª¤ 1 å¹¶åˆ›å»ºä¸¤ä¸ªé™„åŠ ç¯å¢ƒï¼ŒTest å’Œ Load-Testã€‚æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ä½¿ç”¨è¿™äº›ç¯å¢ƒæ¥å±•ç¤ºå¦‚ä½•å¹¶è¡Œæ‰§è¡Œä½œä¸šã€‚ä¸å¿…é…ç½®éƒ¨ç½²åˆ†æ”¯æˆ–å¿…éœ€çš„å®¡æŸ¥è€…ï¼Œåªéœ€æ·»åŠ ä¸€ä¸ª WHO\_TO\_GREET å˜é‡å¹¶è®¾ç½®ç›¸åº”çš„å€¼å³å¯ã€‚ç»“æœåº”è¯¥ç±»ä¼¼äºå›¾ 1.30ï¼š

\myGraphic{0.6}{content/chapter1/images/30.png}{å›¾1.30 --- è®¾ç½®å¤šä¸ªç¯å¢ƒ}

\item 
ç°åœ¨ï¼Œè¿”å›å·¥ä½œæµç¨‹æ–‡ä»¶å¹¶ç¼–è¾‘ã€‚åœ¨ first\_job ä¸‹é¢æ·»åŠ ä¸€ä¸ªåä¸º Test çš„æ–°ä½œä¸šï¼Œåœ¨æœ€æ–°çš„ Ubuntu é•œåƒä¸Šè¿è¡Œã€‚æˆ‘ä»¬å°†æ­¤ä½œä¸šä¸ Test ç¯å¢ƒå…³è”ï¼Œä¸ºäº†åœ¨ first\_job ä¹‹åè¿è¡Œæ­¤ä½œä¸šï¼Œå¯ä»¥ä½¿ç”¨ needs å±æ€§ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºæ‰€ä¾èµ–çš„ä½œä¸šï¼š

\begin{shell}
Test:
  runs-on: ubuntu-latest
  environment: Test
  needs: first_job
\end{shell}

ä¸ºäº†æŸ¥çœ‹å¯†é’¥å¦‚ä½•è¢«ç¯å¢ƒæ‰€è¦†ç›–ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå°æŠ€å·§ã€‚ç”±äº GitHub ä¼šæœç´¢æ—¥å¿—è¾“å‡ºçš„å¯†é’¥å€¼å¯¹å…¶è¿›è¡Œå±è”½ï¼Œæ‰€ä»¥å¿…é¡»ä¿®æ”¹å®é™…æ–‡æœ¬ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ \verb|sed 's/./& /g'|å‘½ä»¤æ¥å®Œæˆæ­¤æ“ä½œã€‚è¿™å°†æŠŠç©ºæ ¼æ·»åŠ åˆ°å¯†é’¥çš„æ¯ä¸ªå­—ç¬¦ä¹‹é—´ã€‚é€šè¿‡è¿™ä¸ªå°æŠ€å·§ï¼ŒTest ä½œä¸šçš„æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š

\begin{tcolorbox}[ breakable,colback = bashcodebg, colframe= black!50!white]
\scriptsize{
- run: | \\
\hspace*{2em}echo "Hello \$\{\{ vars.WHO\_TO\_GREET \}\} \emoji{ğŸ‘‹} from \$\{\{ github.actor \}\}." \\
\hspace*{2em}sec=\$(echo \$\{\{ secrets.MY\_SECRET \}\} | sed 's/./\& /g') \\
\hspace*{2em}echo "My secret is \emoji{ğŸ¤«} '\$sec'."
}
\end{tcolorbox}

\item 
æ¥ä¸‹æ¥ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„ Load-Test ä½œä¸šï¼Œå°†å…¶ä¸ Load-Test ç¯å¢ƒå…³è”ï¼Œå¹¶åœ¨ first\_job ä¹‹åæ‰§è¡Œï¼š

\begin{shell}
Load-Test:
  runs-on: ubuntu-latest
  environment: Load-Test
  needs: first_job
\end{shell}

åªéœ€å¤åˆ¶ Test ä¸­çš„æ­¥éª¤å³å¯ï¼Œæ— éœ€è¿›è¡Œæ›´æ”¹ã€‚

\item 
æœ€åä¸€ä¸ªä½œä¸šæ˜¯ Production ä½œä¸šã€‚é™¤äº†åç§°ä¹‹å¤–ï¼Œenvironment å±æ€§è¿˜æ¥å—ä¸€ä¸ª URLï¼Œè¯¥ URL å°†åœ¨å·¥ä½œæµç¨‹è®¾è®¡å™¨ä¸­æ˜¾ç¤ºã€‚å°†å…¶è®¾ç½®ä¸ºç›¸åº”çš„ URLã€‚ä¸ºäº†å±•ç¤ºåœ¨å·¥ä½œæµç¨‹å¹¶è¡Œæ‰§è¡Œä½œä¸šåå¦‚ä½•å†æ¬¡åˆå¹¶ï¼Œæˆ‘ä»¬å°†åœ¨ Test å’Œ Load-Test ä¹‹åè¿è¡Œ Productionï¼š

\begin{shell}
Production:
  runs-on: ubuntu-latest
  environment:
    name: Production
    url: https://writeabout.net
  needs: [Test, Load-Test]
\end{shell}

åªéœ€å¤åˆ¶å‰ä¸€ä¸ªä½œä¸šçš„æ­¥éª¤å³å¯ã€‚

\item 
å°†æ›´æ”¹æäº¤åˆ° main åˆ†æ”¯ï¼Œå·¥ä½œæµç¨‹å°†è‡ªåŠ¨è¿è¡Œã€‚å¯¼èˆªåˆ°æ–°çš„å·¥ä½œæµç¨‹è¿è¡Œå¹¶æ£€æŸ¥å·¥ä½œæµç¨‹è®¾è®¡å™¨ï¼Œå…¶å¾ˆå¥½åœ°å±•ç¤ºäº†å¹¶è¡Œæ‰§è¡Œã€‚å·¥ä½œæµç¨‹åœ¨æ‰§è¡Œ Production ä¹‹å‰å°†æš‚åœï¼Œå¹¶ç­‰å¾…æ‰¹å‡†(è¯·å‚é˜…å›¾ 1.31)ï¼š

\myGraphic{0.6}{content/chapter1/images/31.png}{å›¾1.31 --- å·¥ä½œæµç¨‹å°†åœ¨å…·æœ‰å¿…éœ€å®¡æŸ¥è€…çš„ç¯å¢ƒä¹‹å‰åœæ­¢ï¼Œå¹¶ç­‰å¾…æ‰¹å‡†}

\item 
ç‚¹å‡»\textbf{Review deployment}(å®¡æŸ¥éƒ¨ç½²)ï¼Œé€‰ä¸­ \textbf{Production} å¹¶æ·»åŠ å¯é€‰è¯„è®ºã€‚ç‚¹å‡»\textbf{Approve and deploy}(æ‰¹å‡†å¹¶éƒ¨ç½²)å¼€å§‹æ‰§è¡Œ Production ä½œä¸š(è§å›¾ 1.32)ï¼š

\myGraphic{0.6}{content/chapter1/images/32.png}{å›¾1.32 --- æ‰¹å‡†å—ä¿æŠ¤çš„ç¯å¢ƒ}

å·¥ä½œæµå°†å®Œå…¨æ‰§è¡Œï¼Œç»“æœåº”è¯¥çœ‹èµ·æ¥åƒå›¾ 1.33ã€‚è¯·æ³¨æ„ï¼ŒURL æ˜¾ç¤ºåœ¨ \textbf{Production} ç¯å¢ƒä¸­ã€‚åŒæ—¶ï¼Œè¯·æ³¨æ„å·¥ä½œæµç¨‹æ‘˜è¦ä¸­çš„æ‰¹å‡†å†å²è®°å½•ï¼š

\myGraphic{0.6}{content/chapter1/images/33.png}{å›¾1.33 --- å·¥ä½œæµçš„æœ€ç»ˆæ‘˜è¦}

æ‰“å¼€å„ä¸ªä½œä¸šå¹¶æ£€æŸ¥æ·»åŠ çš„æ­¥éª¤çš„è¾“å‡º(è§å›¾ 1.34)ã€‚å¯†é’¥å’Œå˜é‡æ¥è‡ªä»£ç åº“ï¼Œå¹¶ä¸”åªæœ‰åœ¨è®¾ç½®ç¯å¢ƒæ—¶æ‰ä¼šè¿›è¡Œè¦†ç›–ï¼š

\myGraphic{0.6}{content/chapter1/images/34.png}{å›¾1.34 --- ç”Ÿäº§å¯†é’¥åªæœ‰åœ¨æ‰¹å‡†åæ‰å¯¹ç”Ÿäº§ç¯å¢ƒå¯ç”¨}

\end{enumerate}

\mySubsubsection{1.8.3}{Thereâ€™s moreâ€¦}

å¦‚æœæ­£åœ¨ä½¿ç”¨ GitHub CLI ä¸ºç¯å¢ƒè®¾ç½®å¯†é’¥æˆ–å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ -{}-env (-e) å‚æ•°æŒ‡å®šã€‚å¯¹äºç»„ç»‡å¯†é’¥ï¼Œå¯ä»¥å°†å¯è§æ€§ (-{}-visibility æˆ– -v) è®¾ç½®ä¸º allã€private æˆ– selectedã€‚å¯¹äº selected,å¿…é¡»ä½¿ç”¨ -{}-repos (-r) æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªä»£ç åº“:

\begin{shell}
$ gh secret set secret-name --env environment-name
$ gh secret set secret-name --org org -v private
$ gh secret set secret-name --org org -v selected -r repo
\end{shell}

ç¯å¢ƒæ¯”æœ¬æŒ‡å—ä¸­ä½¿ç”¨çš„é€‰é¡¹æ›´å¤šã€‚è¿˜å¯ä»¥é…ç½®ä¸€ä¸ªç­‰å¾…è®¡æ—¶å™¨ï¼Œåœ¨å·¥ä½œæµæ‰§è¡Œç‰¹å®šç¯å¢ƒçš„éƒ¨ç½²ä½œä¸šä¹‹å‰ï¼Œå°†å·¥ä½œæµæš‚åœ n åˆ†é’Ÿ(æœ€å¤š 30 å¤©)ã€‚

è¿˜æœ‰ä¸€ä¸ªåä¸ºâ€œè‡ªå®šä¹‰éƒ¨ç½²ä¿æŠ¤è§„åˆ™â€çš„æ–°åŠŸèƒ½ä»å¤„äºæµ‹è¯•é˜¶æ®µã€‚æ­¤åŠŸèƒ½å…è®¸åˆ›å»º GitHub åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå¯ä»¥æš‚åœéƒ¨ç½²å¹¶ç­‰å¾…ç‰¹å®šæ¡ä»¶ã€‚ Datadog,Honeycomb,Sentry,New Relicå’ŒService Nowå·²ç»æœ‰åº”ç”¨ç¨‹åº(è¯·å‚é˜…\url{https://docs.github.com/en/actions/managing-workflow-runs-and-deployments/managing-deployments/configuring-custom-deployment-protection-rules#using-existing-custom-deployment-protection-rules})ã€‚

ç¯å¢ƒä¿æŠ¤è§„åˆ™çš„åŠ›é‡åœ¨äºéƒ¨ç½²åˆ†æ”¯æˆ–æ ‡ç­¾è§„åˆ™ï¼Œè¿™å¯ä»¥é™åˆ¶ä¸é€‚ç”¨äºåˆ†æ”¯ä¿æŠ¤è§„åˆ™çš„ä»£ç éƒ¨ç½²åˆ°æŸäº›ç¯å¢ƒã€‚å¯ä»¥åŒ…æ‹¬å„ç§æ£€æŸ¥ - Codeowners æ‰¹å‡†ã€ä»£ç å®¡æŸ¥è€…ã€éƒ¨ç½²åˆ°æŸäº›å…¶ä»–ç¯å¢ƒã€SonarQube è´¨é‡é—¨\footnote{è´¨é‡é—¨:æ˜¯ä¸€ç§åˆ›æ–°çš„ç®¡ç†ç­–ç•¥ï¼Œå®ƒå°†äº§å“è®¾è®¡æµç¨‹ä¸­çš„å…³é”®èŠ‚ç‚¹è®¾å®šä¸ºä¸¥æ ¼çš„æ£€æŸ¥ç‚¹ï¼Œå°±åƒä¸€é“é“ä¸¥å¯†çš„é—¨åã€‚}å’Œå…¶ä»–è®¸å¤šè‡ªåŠ¨ä»£ç æ£€æŸ¥(è¯·å‚é˜…\url{https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches})ã€‚

























